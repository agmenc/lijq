<!DOCTYPE HTML>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
    <title>LIJQ Testbed</title>
    <script type="text/javascript" src="js/jquery-1.8.3.js"></script>
</head>
<body>
    <h1>LIJQ Testbed</h1>
    <script type="text/javascript">

        var Parser = function(thing) {
            var functions = "";
            var builtIns = "";

            this.parse = function() {
                for (var name in thing) {
                    var t = typeof thing[name];
                    switch (t) {
                        case "function":
                            registerFn(thing, name);
                            break;
                        case "object": case "string": case "number": case "boolean":
                        registerBuiltIn(thing, name);
                        break;
                        default:
                            console.debug(("[[[[[" + t + "]]]]] ===> " + name));
                            break;
                    }
                }

                return builtIns + "\n" + functions;
            };

            function registerFn(parent, name) {
                var signature = parent[name].toString().split("\n")[0];
                var args = signature.replace(/.*function .*\(/, "").replace(/\).*/, "").trim().split(", ");

                var argsLength = parent[name].prototype ? parent[name].prototype.constructor.length : 0;

                var sig = "def " + name+ "(" + toScalaArgs(args) + ") = underlying ~> Run(\"" + name + "(" + toJsArgs(args) + ")\")";
                functions += sig + "\n";
            }

            function registerBuiltIn(parent, name) {
                builtIns += "val " + name + "\n";
            }

            function toScalaArgs(args) {
                // TODO - CAS - 28/11/2012 - Write a foreach
                var appender = "";
                for (var i = 0; i < args.length; i++) {
                    var arg = args[i];
                    appender += arg + ": String";
                    if (i < args.length - 1) appender += ", "
                }
                return appender.replace(", $");
            }

            function toJsArgs(args)  {
                var appender = "";
                for (var i = 0; i < args.length; i++) {
                    appender += "'\" + " + args[i] + " + \"'";
                    if (i < args.length - 1) appender += ", "
                }
                return appender.replace(", $");
            }
        };

        var result = new Parser($).parse();
        console.log(result);

    </script>

<h2>Select a version of JQuery ...</h2>
<h2>Generate ...</h2>
</body>
</html>

